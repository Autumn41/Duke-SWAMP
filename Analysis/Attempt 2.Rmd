---
title: "MP_Analysis"
author: "Autumn Dunn"
date: "2/21/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#rm(list=ls())
```

Packages needed
```{r}
if(!require(pacman)) install.packages("pacman")
pacman::p_load(ggpubr, ggplot2, readxl, dplyr, lubridate, here)
```

Functions Used
```{r}
#Fix days that will not be read as date
fix_day = Vectorize(function(day) {
  if (day %in% 1:9) return(paste0("0", day))
  return(day)
})
```

Upload Data
```{r}
Nitrogen <- read_excel(here("Data/Nitrogen.xlsx"))
Phosphorus <- read_excel(here("Data/Phosphorus.xlsx"))
TotalSuspendedSolids <- read_excel(here("Data/TotalSuspendedSolids.xlsx"))
YSI <- read_excel(here("Data/YSI.xlsx"))
FecalColiform <- read_excel(here("Data/FecalColiform.xlsx"))
```


###    About SWAMP    ###

SWAMP Information:
- Inflow:
    Phase 1 -- WT1
    Phase 3 -- BR5
- Outflow:
    Phase 2 -- WT3
            -- WT5
            -- DS1
    Phase 3 -- WT2
    
Phase Details:
- Phase 1 = stream reconfigutation
- Phase 2 = dam and impoundment
- Phase 3 = treatment wetland

Site Details:
- WT1 = Downstream of culvert at HWY 751, CONTROL SITE
- WT2 = Downstream of tributary after Phase III
- WT3 = Upstream of sewer line
- WT5 = Upstream of old dam structure within retention basin of concrete dam, IMPACT SITE
- BR5 = Bio-retention Upstream across HWY 751
- DS1 = Downstream of old concrete dam structure

###                   ###  


###    About Duke Garden    ###

Duke Garden Site Information:
- water flows from Upper pond, to duck pond, down to south pond
- DP sites are a part of SWAMP data samples, but taken within Duke Gardens 

Site Details:
- D = Duck Pond
- S = South Pond
- U = Upper Pond
- DP1 = Turtle Pond
- DP2 = near Duck Pond
- DP3 = Pond at south lawn

###                         ###  


####  Water Quality Standards ####

Variables:
- Nitrogen (NOx, TN, NH)
  (TN - Total Nitrogen) EPA Nutrient Ecoregion IX Level III Ecogeion 45 (Piedmont): 800 ug/L 
  (NH - Ammonium) EPA standard for NH: 20 ug/L
  (NOx - Nitrous Oxide) EPA Nutrient Ecoregion IX Level III Ecogeion 45 (Piedmont: 345 ug/L
- Phosphorus (TP - Total Phosphorus)
    EPA Nutrient Ecoregion IX Level III Ecogeion 45 (Piedmont): 30 ug/L
- Fecal Coliform (FC)
    State of NC water quality criteria: 200 colonies/100 mL
- Temperature (Temp)
    NCDENR/DWQ standard for lower Piedmont, non-trout streams: < 32 C
- pH
    NC water quality standard: 6-9
- Sediment (TSS)
    EPA standard for TSS for 30-day average: 30,000 ug/L
    EPA standard for TSS for 7-day average: 45,000 ug/L

####                          ####

Processing Data
```{r}
#combine and isolate SWAMP data
SWAMP_Nitrogen<- Nitrogen %>%
  select(`Month`, `Day`, `Year`, `Site`, `Total N (ug/L)`, `NH4-N (ug/L)`, `NOX`) %>% 
  filter(Site %in% c("WT1", "WT2", "WT3", "WT5", "BR5", "DS1"))

SWAMP_Phosphorus<- Phosphorus %>%
  select(`Month`, `Day`, `Year`, `Site`, `UTP`) %>% 
  filter(Site %in% c("WT1", "WT2", "WT3", "WT5", "BR5", "DS1"))

SWAMP_FecalColiform<- FecalColiform %>%
  select(`Month`, `Day`, `Year`, `Site`, `FC`) %>% 
  filter(Site %in% c("WT1", "WT2", "WT3", "WT5", "BR5", "DS1"))

SWAMP_TotalSuspendedSolids<- TotalSuspendedSolids %>%
  select(`Month`, `Day`, `Year`, `Site`, `TSS (mg/L)`) %>% 
  filter(Site %in% c("WT1", "WT2", "WT3", "WT5", "BR5", "DS1"))

SWAMP_YSI<- YSI %>%
  select(`Month`, `Day`, `Year`, `Site`, `pH`, `Temp C`) %>% 
  filter(Site %in% c("WT1", "WT2", "WT3", "WT5", "BR5", "DS1"))

SWAMP_Data<- bind_rows(SWAMP_Nitrogen, SWAMP_Phosphorus, SWAMP_FecalColiform, SWAMP_TotalSuspendedSolids, SWAMP_YSI)

SWAMP_means <- SWAMP_Data %>% 
  group_by(`Month`, `Day`, `Year`, `Site`) %>% 
summarise(Mean_TN = mean(`Total N (ug/L)`),
          Mean_NH = mean(`NH4-N (ug/L)`),
          Mean_NOX = mean(`NOX`),
          Mean_TP = mean(`UTP`),
          Mean_FC = mean(`FC`),
          Mean_TSS = mean(`TSS (mg/L)`),
          Mean_Temp = mean(`Temp C`),
          )

ALL_SWAMP_data<- bind_rows(SWAMP_Data, SWAMP_means)

#Combine and Isolate Duke Garden Data
DukeGarden_Nitrogen<- Nitrogen %>%
  select(`Month`, `Day`, `Year`, `Site`, `Total N (ug/L)`, `NH4-N (ug/L)`, `NOX`) %>% 
  filter(Site %in% c("D", "S", "U", "DP1", "DP2", "DP3"))

DukeGarden_Phosphorus<- Phosphorus %>%
  select(`Month`, `Day`, `Year`, `Site`, `UTP`) %>% 
  filter(Site %in% c("D", "S", "U", "DP1", "DP2", "DP3"))

DukeGarden_FecalColiform<- FecalColiform %>%
  select(`Month`, `Day`, `Year`, `Site`, `FC`) %>% 
  filter(Site %in% c("D", "S", "U", "DP1", "DP2", "DP3"))

DukeGarden_TotalSuspendedSolids<- TotalSuspendedSolids %>%
  select(`Month`, `Day`, `Year`, `Site`, `TSS (mg/L)`) %>% 
  filter(Site %in% c("D", "S", "U", "DP1", "DP2", "DP3"))

DukeGarden_YSI<- YSI %>%
  select(`Month`, `Day`, `Year`, `Site`, `pH`, `Temp C`) %>% 
  filter(Site %in% c("D", "S", "U", "DP1", "DP2", "DP3"))

DukeGarden_Data<- bind_rows(DukeGarden_Nitrogen, DukeGarden_Phosphorus, DukeGarden_FecalColiform, DukeGarden_TotalSuspendedSolids, DukeGarden_YSI)
```


Question 1. How does SWAMP water quality compare to EPA standards?
```{r}
#Outflow sites were used to compare to EPA standards
#outflow sites: WT2, WT3, WT5, DS1
#Provide mean, median, and yearly average

###   Nitrogen   ###



###   Phosphorus   ###

###   Fecal Coliform   ###

###   Temperature   ###

###   pH   ###

###   Sediment   ###

```

Question 2. How effective is SWAMP in water quality treatment?
```{r}
#Inflow and Outflow sites compared
#WT1 is a control site, considered pre-treatment to SWAMP
#WT1 compared to BR5
#WT1 compared to outflow points WT2, WT3, WT5, DS1
#Provide mean, median, and yearly average

###   Nitrogen   ###
ALL_SWAMP_data %>%
  filter(Site %in% c("WT5", "WT1")) %>%
  mutate(date = ydm(paste0(Year, fix_day(Day), Month, sep="-"))) %>% 
ggplot(aes(x = date, y = log(`Total N (ug/L)`), colour = Site)) +
  geom_abline(aes(intercept=log(800), slope=0, lty='EPA Standard of total nitrogen for Ecoregion IX')) +
  scale_linetype(name = NULL) +
  geom_smooth(se=TRUE, method = "loess", span=0.2) +
    xlab("Year") +
  ylab("Total Nitrogen (ug/L)") +
  ggtitle("Total Nitrogen for..." ) +
geom_smooth(aes(x=date, y=log(`Mean_TN`), colour = Site), method = "loess", span=0.2) +
  mytheme 



###   Phosphorus   ###

###   Fecal Coliform   ###

###   Temperature   ###

###   pH   ###

###   Sediment   ###

```

Question 3. How much is Duke Garden effecting SWAMP's water quality?
```{r}

###   Nitrogen   ###

###   Phosphorus   ###

###   Fecal Coliform   ###

###   Temperature   ###

###   pH   ###

###   Sediment   ###

```

Question 4. What is the future of SWAMP water treatment?
```{r}

###   Nitrogen   ###

###   Phosphorus   ###

###   Fecal Coliform   ###

###   Temperature   ###

###   pH   ###

###   Sediment   ###

```


