---
title: "MP_Analysis"
author: "Autumn Dunn"
date: "2/21/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#rm(list=ls())
```

Packages needed
```{r}
if(!require(pacman)) install.packages("pacman")
pacman::p_load(ggpubr, ggplot2, readxl, tidyverse, dplyr, lubridate, here, pkgcond, dataRetrieval, EGRET)
```

Functions Used
```{r}
#Fix days that will not be read as date
fix_day = Vectorize(function(day) {
  if (day %in% 1:9) return(paste0("0", day))
  return(day)
})

#Graph Theme
mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top") #alternative: legend.position + legend.justification

#Suppress Messages
suppress_messages(expr)
```


Upload Data
```{r}
Nitrogen <- read_excel(here("Data/Nitrogen.xlsx"))
Phosphorus <- read_excel(here("Data/Phosphorus.xlsx"))
TotalSuspendedSolids <- read_excel(here("Data/TotalSuspendedSolids.xlsx"))
YSI <- read_excel(here("Data/YSI.xlsx"))
FecalColiform <- read_excel(here("Data/FecalColiform.xlsx"))
```

Processing Data
```{r}
#combine and isolate SWAMP data
SWAMP_Nitrogen<- Nitrogen %>%
  select(`Month`, `Day`, `Year`, `Site`, `Total N (ug/L)`, `NH4-N (ug/L)`, `NOX`) %>% 
  filter(Site %in% c("WT1", "WT2", "WT3", "WT5", "BR5", "DS1"))

SWAMP_Phosphorus<- Phosphorus %>%
  select(`Month`, `Day`, `Year`, `Site`, `UTP`) %>% 
  filter(Site %in% c("WT1", "WT2", "WT3", "WT5", "BR5", "DS1"))

SWAMP_FecalColiform<- FecalColiform %>%
  select(`Month`, `Day`, `Year`, `Site`, `FC`) %>% 
  filter(Site %in% c("WT1", "WT2", "WT3", "WT5", "BR5", "DS1"))

SWAMP_TotalSuspendedSolids<- TotalSuspendedSolids %>%
  select(`Month`, `Day`, `Year`, `Site`, `TSS (mg/L)`) %>% 
  filter(Site %in% c("WT1", "WT2", "WT3", "WT5", "BR5", "DS1"))

SWAMP_YSI<- YSI %>%
  select(`Month`, `Day`, `Year`, `Site`, `pH`, `Temp C`) %>% 
  filter(Site %in% c("WT1", "WT2", "WT3", "WT5", "BR5", "DS1"))

ALL_SWAMP_data<- bind_rows(SWAMP_Nitrogen, SWAMP_Phosphorus, SWAMP_FecalColiform, SWAMP_TotalSuspendedSolids, SWAMP_YSI)
ALL_SWAMP_data$pH<- as.numeric(ALL_SWAMP_data$pH)
ALL_SWAMP_data$`Temp C`<- as.numeric(ALL_SWAMP_data$`Temp C`)

#Combine and Isolate Duke Garden Data
DukeGarden_Nitrogen<- Nitrogen %>%
  select(`Month`, `Day`, `Year`, `Site`, `Total N (ug/L)`, `NH4-N (ug/L)`, `NOX`) %>% 
  filter(Site %in% c("D", "S", "U", "DP1", "DP2", "DP3"))

DukeGarden_Phosphorus<- Phosphorus %>%
  select(`Month`, `Day`, `Year`, `Site`, `UTP`) %>% 
  filter(Site %in% c("D", "S", "U", "DP1", "DP2", "DP3"))

DukeGarden_FecalColiform<- FecalColiform %>%
  select(`Month`, `Day`, `Year`, `Site`, `FC`) %>% 
  filter(Site %in% c("D", "S", "U", "DP1", "DP2", "DP3"))

DukeGarden_TotalSuspendedSolids<- TotalSuspendedSolids %>%
  select(`Month`, `Day`, `Year`, `Site`, `TSS (mg/L)`) %>% 
  filter(Site %in% c("D", "S", "U", "DP1", "DP2", "DP3"))

DukeGarden_YSI<- YSI %>%
  select(`Month`, `Day`, `Year`, `Site`, `pH`, `Temp C`) %>% 
  filter(Site %in% c("D", "S", "U", "DP1", "DP2", "DP3"))

DukeGarden_Data<- bind_rows(DukeGarden_Nitrogen, DukeGarden_Phosphorus, DukeGarden_FecalColiform, DukeGarden_TotalSuspendedSolids, DukeGarden_YSI)
```

Retrieve Water Flow Data - USGS
  Site Numbers
    Sandy Creek at Cornwallis Rd Near Durham, NC: 0209722970
        Start date: 2008-07-22
        End date: 2021-03-08
    Sandy Creek at Picket Road, Durham, NC (downstream of SWAMP): 02097230
        Start date: 2008-07-22
        End date: 2021-03-08
#Special note: Picket Road site does not have daily discharge

  Parameter numbers: 
    Daily Discharge, cubic feet per second: 00060
    Discharge, instantaneous, cubic feet per second: 00061
    Flow rate, instantaneous, gallons per minute: 00059
    Gage Height, feet: 00065
```{r}
#USGS Data Retrieval 
  #Site = Sandy Creek at Cornwallis
  #Parameter = daily discharge
DailyDischarge_Sandy<-readNWISDaily("0209722970", "00060", "2008-07-22", "2021-03-08")

#Retrieve metadata for site and parameter
  #Site = Sandy Creek at Cornwallis
  #Parameter = daily discharge
Info_Sandy <- readNWISInfo("0209722970", "00060")

#organize into list
eList_Sandy <- as.egret(Info_Sandy, DailyDischarge_Sandy)

#set period of analysis
Sandy_PA<-setPA(eList_Sandy)

#Print info for 7-day minimum and max mean of daily mean discharge
Sandy_Seven_Day_min<-plotFlowSingle(Sandy_PA, istat = 2, runoff = FALSE)
Sandy_Seven_Day_max<-plotFlowSingle(Sandy_PA, istat = 7, runoff = FALSE)

#print info for 30-day minimum and max mean of daily mean discharge
Sandy_thirty_Day_min<-plotFlowSingle(Sandy_PA, istat = 3, runoff = FALSE)
Sandy_thirty_Day_max<-plotFlowSingle(Sandy_PA, istat = 6, runoff = FALSE)

#print info for mean of daily mean discharge
Sandy_mean<-plotFlowSingle(Sandy_PA, istat = 5, runoff = FALSE)

#print info for median of daily mean discharge
Sandy_median<-plotFlowSingle(Sandy_PA, istat = 4, runoff = FALSE)

```

###    About SWAMP    ###

SWAMP Information:
- Inflow:
    Phase 1 -- WT1
    Phase 3 -- BR5
- Outflow:
    Phase 2 -- WT3
            -- WT5
            -- DS1
    Phase 3 -- WT2
    
Phase Details:
- Phase 1 = stream reconfigutation
- Phase 2 = dam and impoundment
- Phase 3 = treatment wetland

Site Details:
- WT1 = Downstream of culvert at HWY 751, CONTROL SITE
- WT2 = Downstream of tributary after Phase III
- WT3 = Upstream of sewer line
- WT5 = Upstream of old dam structure within retention basin of concrete dam, IMPACT SITE
- BR5 = Bio-retention Upstream across HWY 751
- DS1 = Downstream of old concrete dam structure

###                   ###  


###    About Duke Garden    ###

Duke Garden Site Information:
- water flows from Upper pond, to duck pond, down to south pond
- DP sites are a part of SWAMP data samples, but taken within Duke Gardens 

Site Details:
- D = Duck Pond
- S = South Pond
- U = Upper Pond
- DP1 = Turtle Pond
- DP2 = near Duck Pond
- DP3 = Pond at south lawn

###                         ###  


####  Water Quality Standards ####

Variables:
- Nitrogen (NOx, TN, NH)
  (TN - Total Nitrogen) EPA Nutrient Ecoregion IX Level III Ecogeion 45 (Piedmont): 800 ug/L 
  (NH - Ammonium) EPA standard for NH: 20 ug/L
  (NOx - Nitrous Oxide) EPA Nutrient Ecoregion IX Level III Ecogeion 45 (Piedmont: 345 ug/L
- Phosphorus (TP - Total Phosphorus)
    EPA Nutrient Ecoregion IX Level III Ecogeion 45 (Piedmont): 30 ug/L
- Fecal Coliform (FC)
    State of NC water quality criteria: 200 colonies/100 mL
- Temperature (Temp)
    NCDENR/DWQ standard for lower Piedmont, non-trout streams: < 32 C
- pH
    NC water quality standard: 6-9
- Sediment (TSS)
    EPA standard for TSS for 30-day average: 30,000 ug/L
    EPA standard for TSS for 7-day average: 45,000 ug/L

####                          ####



Question 1. How does SWAMP water quality compare to EPA standards?
```{r}
#Outflow sites were used to compare to EPA standards
#outflow sites: WT2, WT3, WT5
#Provide mean, median, and yearly average

###   Nitrogen   ###

#Total Nitrogen - mean, median, yearly average
TN_summary <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`) %>% 
  summarise(Mean_TN = mean(`Total N (ug/L)`, na.rm=TRUE),
         Median_TN = median(`Total N (ug/L)`, na.rm=TRUE))
print(TN_summary)

TN_Yearly <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`, `Year`) %>% 
  summarise(Yearly_Mean_TN = mean(`Total N (ug/L)`, na.rm=TRUE),
         Yearly_Median_TN = median(`Total N (ug/L)`, na.rm=TRUE))
print(TN_Yearly)

#Ammonium - mean, median, yearly average
NH_summary <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`) %>% 
  summarise(Mean_NH = mean(`NH4-N (ug/L)`, na.rm=TRUE),
         Median_NH = median(`NH4-N (ug/L)`, na.rm=TRUE))
print(NH_summary)

NH_Yearly <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`, `Year`) %>% 
  summarise(Yearly_Mean_NH = mean(`NH4-N (ug/L)`, na.rm=TRUE),
         Yearly_Median_NH = median(`NH4-N (ug/L)`, na.rm=TRUE))
print(NH_Yearly)

###   Phosphorus   ###
#Phosphorus - mean, median, yearly average
TP_summary <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`) %>% 
  summarise(Mean_TP = mean(`UTP`, na.rm=TRUE),
         Median_TP = median(`UTP`, na.rm=TRUE))
print(TP_summary)

TP_Yearly <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`, `Year`) %>% 
  summarise(Yearly_Mean_TP = mean(`UTP`, na.rm=TRUE),
         Yearly_Median_TP = median(`UTP`, na.rm=TRUE))
print(TP_Yearly)

###   Fecal Coliform   ###
#Fecal Coliform - mean, median, yearly average
FC_summary <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`) %>% 
  summarise(Mean_FC = mean(`FC`, na.rm=TRUE),
         Median_FC = median(`FC`, na.rm=TRUE))
print(FC_summary)

FC_Yearly <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`, `Year`) %>% 
  summarise(Yearly_Mean_FC = mean(`FC`, na.rm=TRUE),
         Yearly_Median_FC = median(`FC`, na.rm=TRUE))
print(FC_Yearly)

###   Temperature   ###
#Temperature - mean, median, yearly average
Temp_summary <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`) %>% 
  summarise(Mean_Temp = mean(`Temp C`, na.rm=TRUE),
         Median_Temp = median(`Temp C`, na.rm=TRUE))
print(Temp_summary)

Temp_Yearly <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`, `Year`) %>% 
  summarise(Yearly_Mean_Temp = mean(`Temp C`, na.rm=TRUE),
         Yearly_Median_Temp = median(`Temp C`, na.rm=TRUE))
print(Temp_Yearly)

###   pH   ###
#pH - mean, median, yearly average
pH_summary <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`) %>% 
  summarise(Mean_pH = mean(`pH`, na.rm=TRUE),
         Median_pH = median(`pH`, na.rm=TRUE))
print(pH_summary)

pH_Yearly <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`, `Year`) %>% 
  summarise(Yearly_Mean_pH = mean(`pH`, na.rm=TRUE),
         Yearly_Median_pH = median(`pH`, na.rm=TRUE))
print(pH_Yearly)

###   Sediment   ###
#Sediment - mean, median, yearly average
TSS_summary <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`) %>% 
  summarise(Mean_TSS = mean(`TSS (mg/L)`, na.rm=TRUE),
         Median_TSS = median(`TSS (mg/L)`, na.rm=TRUE))
print(TSS_summary)

TSS_Yearly <- ALL_SWAMP_data %>% 
  filter(Site %in% c("WT2", "WT3", "WT5")) %>% 
  group_by(`Site`, `Year`) %>% 
  summarise(Yearly_Mean_TSS = mean(`TSS (mg/L)`, na.rm=TRUE),
         Yearly_Median_TSS = median(`TSS (mg/L)`, na.rm=TRUE))
print(TSS_Yearly)

```

Question 2. How effective is SWAMP in water quality treatment?
```{r}
#Inflow and Outflow sites compared
#WT1 is a control site, considered pre-treatment to SWAMP
#WT1 compared to BR5
#WT1 compared to outflow points WT2, WT3, WT5
#Provide mean, median, and yearly average

###   Nitrogen   ###
  

###   Phosphorus   ###

###   Fecal Coliform   ###

###   Temperature   ###

###   pH   ###

###   Sediment   ###

```

Question 3. How much is Duke Garden effecting SWAMP's water quality?
```{r}

###   Nitrogen   ###

###   Phosphorus   ###

###   Fecal Coliform   ###

###   Temperature   ###

###   pH   ###

###   Sediment   ###

```

Question 4. What is the future of SWAMP water treatment?
```{r}

###   Nitrogen   ###

###   Phosphorus   ###

###   Fecal Coliform   ###

###   Temperature   ###

###   pH   ###

###   Sediment   ###

```


