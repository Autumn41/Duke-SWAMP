---
title: "Question 1. How does SWAMP water quality compare to water quality standards?"
author: "Autumn Dunn"
date: "3/13/2021"
output: pdf_document
---

Contents:
  -    Summary
  -    Water Quality Standards
  -    Packages Needed
  -    Functions Used
  -    Upload Data
  -    Processing Data
  -    About SWAMP
  -    Analysis : Daily
  -    Daily Summary
  -    Analysis : Monthly
  -    Monthly Summary
  -    Analysis : Yearly
  -    Yearly Summary
  -    Water Quality Index

Summary:

  The goal of this portion of the analysis is to determine if SWAMP met the water quality standard goals. This was done by comparing outflow sites to water quality standards defined below in the water quality standards section. Outflow sites for SWAMP were identified as WT3 and WT5. WT2 was also considered an outflow site, but removed from this portion of the analysis due to limited data and relocation in 2011. Sampling period of analysis was after Phase I, II, and III establishment and was from 2008 to 2020. This is an update to Richardson (2011) paper located in relevant literature folder, so this analysis is considered the updated assessment of SWAMP through long-term monitoring that has continued since the publication of the paper. Water quality standards were compared on a daily, monthly, and yearly basis for all water quality parameters except total suspended solids. A water quality index was created using a harmonic square water quality index, which is unweighted and is the most sensistive index. Water quality index provides a simplified way to assess water quality at each location and time based on the eight water quality parameters of interest.

Data for this analysis is located in the Data folder and is called upon in the code.




####  Water Quality Standards ####

Variables:
- Nitrogen (NOx, TN, NH)
  (TN - Total Nitrogen) EPA Nutrient Ecoregion IX Level III Ecogeion 45 (Piedmont): 800 ug/L 
  (NH - Ammonium) EPA standard for NH: 20 ug/L
  (NOx - Nitrous Oxide) EPA Nutrient Ecoregion IX Level III Ecogeion 45 (Piedmont: 345 ug/L
- Phosphorus (TP - Total Phosphorus)
    EPA Nutrient Ecoregion IX Level III Ecogeion 45 (Piedmont): 30 ug/L
- Fecal Coliform (FC)
    State of NC water quality criteria: 200 colonies/100 mL
- Temperature (Temp)
    NCDENR/DWQ standard for lower Piedmont, non-trout streams: < 32 C
- pH
    NC water quality standard: 6-9
- Sediment (TSS)
    EPA standard for TSS for 30-day average: 30,000 ug/L
    EPA standard for TSS for 7-day average: 45,000 ug/L

####                          ####

Packages Needed
```{r}
if(!require(pacman)) install.packages("pacman")
pacman::p_load(ggpubr, ggplot2, readxl, tidyverse, dplyr, lubridate, here, pkgcond, dataRetrieval, EGRET, naniar, arsenal, gam)
```

Functions Used
```{r}
#Fix days that will not be read as date
fix_day = Vectorize(function(day) {
  if (day %in% 1:9) return(paste0("0", day))
  return(day)
})

#Process data
Process_Data<- function(df) {
  df %>% 
  select(any_of(c("Total N (ug/L)", "NH4-N (ug/L)", "NOX", "UTP", "FC", "pH", "Temp C", "TSS (mg/L)", "Month", "Day", "Year", "Site")))
}

#duplicate dates
Too_many_dates = function(x) {
  x[!duplicated(x[c('date')]),]
}
   
#Graph Theme
mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top") #alternative: legend.position + legend.justification

#Suppress Messages
suppress_messages(expr)
```

Upload Data
```{r}
Nitrogen             <- read_excel(here("Data/Nitrogen.xlsx"))
Phosphorus           <- read_excel(here("Data/Phosphorus.xlsx"))
TotalSuspendedSolids <- read_excel(here("Data/TotalSuspendedSolids.xlsx"))
YSI                  <- read_excel(here("Data/YSI.xlsx"))
FecalColiform        <- read_excel(here("Data/FecalColiform.xlsx"))
```


Processing Data
```{r}
#combine and isolate SWAMP data
SWAMP_data         <- bind_rows((
                      Process_Data(Nitrogen)), 
                      Process_Data(Phosphorus), 
                      Process_Data(FecalColiform), 
                      Process_Data(TotalSuspendedSolids), 
                      Process_Data(YSI))

#make pH and Temperature numeric
SWAMP_data$pH      <- as.numeric(SWAMP_data$pH)
SWAMP_data$`Temp C`<- as.numeric(SWAMP_data$`Temp C`)

#add date column to data
SWAMP_data         <- SWAMP_data %>%
                      mutate(date = ydm(paste0(Year, fix_day(Day), Month, sep="-")))
```


###    About SWAMP    ###

SWAMP Information:
- Inflow:
    Phase 1 -- WT1
    Phase 3 -- BR5
- Outflow:
    Phase 2 -- WT3
            -- WT5
            -- DS1
    Phase 3 -- WT2
    
Phase Details:
- Phase 1 = stream reconfigutation
- Phase 2 = dam and impoundment
- Phase 3 = treatment wetland

Site Details:
- WT1 = Downstream of culvert at HWY 751, CONTROL SITE
- WT2 = Downstream of tributary after Phase III
- WT3 = Upstream of sewer line
- WT5 = Upstream of old dam structure within retention basin of concrete dam, IMPACT SITE
- BR5 = Bio-retention Upstream across HWY 751
- DS1 = Downstream of old concrete dam structure

###                   ###

Analysis : Daily
```{r}
#Determine how many days from 2008 to 2020 that WT3 and WT5 exceeded water quality standard based on daily average

### Daily Average from 2008 - 2020 for WT3 ###
#TN
  TN_WT3_day     <- SWAMP_data %>% 
                    filter(Site %in% c("WT3")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `Total N (ug/L)`) %>% 
                    na.omit()
  Daily_TN_WT3   <- TN_WT3_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_TN = mean(`Total N (ug/L)`)) %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(TN_Exceeded = ifelse(Mean_TN > 800, Mean_TN, NA))
#NH
  NH_WT3_day     <- SWAMP_data %>% 
                    filter(Site %in% c("WT3")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `NH4-N (ug/L)`) %>% 
                    na.omit()
  Daily_NH_WT3   <- NH_WT3_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_NH = mean(`NH4-N (ug/L)`))%>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(NH_Exceeded = ifelse(Mean_NH > 20, Mean_NH, NA)) 
#NOX
  NOX_WT3_day    <- SWAMP_data %>% 
                    filter(Site %in% c("WT3")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `NOX`) %>% 
                    na.omit()
  Daily_NOX_WT3  <- NOX_WT3_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_NOX = mean(`NOX`)) %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(NOX_Exceeded = ifelse(Mean_NOX > 345, Mean_NOX, NA))
#pH
  pH_WT3_day     <- SWAMP_data %>% 
                    filter(Site %in% c("WT3")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `pH`) %>% 
                    na.omit()
  Daily_pH_WT3   <- pH_WT3_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_pH = mean(`pH`)) %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(pH_Exceeded = ifelse(!(Mean_pH >6) & !(Mean_pH < 9), Mean_pH, NA))
#Temp
  Temp_WT3_day   <- SWAMP_data %>% 
                    filter(Site %in% c("WT3")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `Temp C`) %>% 
                    na.omit()
  Daily_Temp_WT3 <- Temp_WT3_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_Temp = mean(`Temp C`))%>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(Temp_Exceeded = ifelse(Mean_Temp > 32, Mean_Temp, NA)) 
#TP
  TP_WT3_day     <- SWAMP_data %>% 
                    filter(Site %in% c("WT3")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `UTP`) %>% 
                    na.omit()
  Daily_TP_WT3   <- TP_WT3_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_TP = mean(`UTP`)) %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(TP_Exceeded = ifelse(Mean_TP > 30, Mean_TP, NA)) 
#FC
  FC_WT3_day     <- SWAMP_data %>% 
                    filter(Site %in% c("WT3")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `FC`) %>% 
                    na.omit()
  Daily_FC_WT3   <- FC_WT3_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_FC = mean(`FC`)) %>% 
                    group_by(`Site`,`Day`, `Year`, `Month`) %>% 
                    mutate(FC_Exceeded = ifelse(Mean_FC > 200, Mean_FC, NA))

### Daily Average from 2008 - 2020 for WT5 ###
#TN
  TN_WT5_day     <- SWAMP_data %>% 
                    filter(Site %in% c("WT5")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `Total N (ug/L)`) %>% 
                    na.omit()
  Daily_TN_WT5   <- TN_WT5_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_TN = mean(`Total N (ug/L)`)) %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(TN_Exceeded = ifelse(Mean_TN > 800, Mean_TN, NA))
#NH
  NH_WT5_day     <- SWAMP_data %>% 
                    filter(Site %in% c("WT5")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `NH4-N (ug/L)`) %>% 
                    na.omit()
  Daily_NH_WT5   <- NH_WT5_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_NH = mean(`NH4-N (ug/L)`)) %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(NH_Exceeded = ifelse(Mean_NH > 20, Mean_NH, NA)) 
#NOX
  NOX_WT5_day    <- SWAMP_data %>% 
                    filter(Site %in% c("WT5")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `NOX`) %>% 
                    na.omit()
  Daily_NOX_WT5  <- NOX_WT5_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_NOX = mean(`NOX`)) %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(NOX_Exceeded = ifelse(Mean_NOX > 345, Mean_NOX, NA))
#pH
  pH_WT5_day     <- SWAMP_data %>% 
                    filter(Site %in% c("WT5")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `pH`) %>% 
                    na.omit()
  Daily_pH_WT5   <- pH_WT5_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_pH = mean(`pH`)) %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(pH_Exceeded = ifelse(!(Mean_pH >6) & !(Mean_pH < 9), Mean_pH, NA))
#Temp
  Temp_WT5_day   <- SWAMP_data %>% 
                    filter(Site %in% c("WT5")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `Temp C`) %>% 
                    na.omit()
  Daily_Temp_WT5 <- Temp_WT5_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_Temp = mean(`Temp C`)) %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(Temp_Exceeded = ifelse(Mean_Temp > 32, Mean_Temp, NA)) 
#TP
  TP_WT5_day     <- SWAMP_data %>% 
                    filter(Site %in% c("WT5")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `UTP`) %>% 
                    na.omit()
  Daily_TP_WT5   <- TP_WT5_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_TP = mean(`UTP`)) %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    mutate(TP_Exceeded = ifelse(Mean_TP > 30, Mean_TP, NA)) 
#FC
  FC_WT5_day     <- SWAMP_data %>% 
                    filter(Site %in% c("WT5")) %>% 
                    filter(Year %in% c(2008:2020)) %>% 
                    select(`Site`, `Day`,`Month`, `Year`, `FC`) %>% 
                    na.omit()
  Daily_FC_WT5   <- FC_WT5_day %>% 
                    group_by(`Site`, `Day`,`Month`, `Year`) %>% 
                    summarise(Mean_FC = mean(`FC`)) %>% 
                    group_by(`Site`,`Day`, `Year`, `Month`) %>% 
                    mutate(FC_Exceeded = ifelse(Mean_FC > 200, Mean_FC, NA))


  
### count how many days exceed water quality standard for WT3 ###
#TN
  WT3_TN_Exceeded_count_day   <- Daily_TN_WT3 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_TN = sum(!is.na(TN_Exceeded)),
                                 Count_all_TN = sum(!is.na(Mean_TN)))
#NH
  WT3_NH_Exceeded_count_day   <- Daily_NH_WT3 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_NH = sum(!is.na(NH_Exceeded)),
                                 Count_all_NH = sum(!is.na(Mean_NH)))  
#NOX
  WT3_NOX_Exceeded_count_day  <- Daily_NOX_WT3 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_NOX = sum(!is.na(NOX_Exceeded)),
                                 Count_all_NOX = sum(!is.na(Mean_NOX)))
#pH
  WT3_pH_Exceeded_count_day   <- Daily_pH_WT3 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_pH = sum(!is.na(pH_Exceeded)),
                                 Count_all_pH = sum(!is.na(Mean_pH)))
#Temp
  WT3_Temp_Exceeded_count_day <- Daily_Temp_WT3 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_Temp = sum(!is.na(Temp_Exceeded)),
                                 Count_all_Temp = sum(!is.na(Mean_Temp)))
#TP
  WT3_TP_Exceeded_count_day   <- Daily_TP_WT3 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_TP = sum(!is.na(TP_Exceeded)),
                                 Count_all_TP = sum(!is.na(Mean_TP)))
#FC
  WT3_FC_Exceeded_count_day   <- Daily_FC_WT3 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_FC = sum(!is.na(FC_Exceeded)),
                                 Count_all_FC = sum(!is.na(Mean_FC)))

### count how many days exceed water quality standard for WT5 ###
#TN
  WT5_TN_Exceeded_count_day   <- Daily_TN_WT5 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_TN = sum(!is.na(TN_Exceeded)),
                                 Count_all_TN = sum(!is.na(Mean_TN)))
#NH
  WT5_NH_Exceeded_count_day   <- Daily_NH_WT5 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_NH = sum(!is.na(NH_Exceeded)),
                                 Count_all_NH = sum(!is.na(Mean_NH)))  
#NOX
  WT5_NOX_Exceeded_count_day  <- Daily_NOX_WT5 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_NOX = sum(!is.na(NOX_Exceeded)),
                                 Count_all_NOX = sum(!is.na(Mean_NOX)))
#pH
  WT5_pH_Exceeded_count_day   <- Daily_pH_WT5 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_pH = sum(!is.na(pH_Exceeded)),
                                 Count_all_pH = sum(!is.na(Mean_pH)))
#Temp
  WT5_Temp_Exceeded_count_day <- Daily_Temp_WT5 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_Temp = sum(!is.na(Temp_Exceeded)),
                                 Count_all_Temp = sum(!is.na(Mean_Temp)))
#TP
  WT5_TP_Exceeded_count_day   <- Daily_TP_WT5 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_TP = sum(!is.na(TP_Exceeded)),
                                 Count_all_TP = sum(!is.na(Mean_TP)))
#FC
  WT5_FC_Exceeded_count_day   <- Daily_FC_WT5 %>% 
                                 group_by(Site) %>%
                                 summarize(count_exceed_FC = sum(!is.na(FC_Exceeded)),
                                 Count_all_FC = sum(!is.na(Mean_FC)))
  
```

Daily Summary:
```{r}
### WT3 ###
WT3_daily             <- t(
                         merge(WT3_FC_Exceeded_count_day, 
                         merge(WT3_NH_Exceeded_count_day, 
                         merge(WT3_TN_Exceeded_count_day, 
                         merge(WT3_NOX_Exceeded_count_day, 
                         merge(WT3_pH_Exceeded_count_day, 
                         merge(WT3_TP_Exceeded_count_day, 
                             WT3_Temp_Exceeded_count_day))))), 
                         by = "Site"))

WT3_TN_daily_exceed   <- Daily_TN_WT3 %>% 
                         select(`Day`, `Month`, `Year`, `TN_Exceeded`) %>% 
                         na.omit()
WT3_FC_daily_exceed   <- Daily_FC_WT3 %>% 
                         select(`Day`, `Month`, `Year`, `FC_Exceeded`) %>% 
                         na.omit()
WT3_NH_daily_exceed   <- Daily_NH_WT3 %>% 
                         select(`Day`, `Month`, `Year`, `NH_Exceeded`) %>% 
                         na.omit()
WT3_NOX_daily_exceed  <- Daily_NOX_WT3 %>% 
                         select(`Day`, `Month`, `Year`, `NOX_Exceeded`) %>% 
                         na.omit()
WT3_Temp_daily_exceed <- Daily_Temp_WT3 %>% 
                         select(`Day`, `Month`, `Year`, `Temp_Exceeded`) %>% 
                         na.omit()
WT3_pH_daily_exceed   <- Daily_pH_WT3 %>% 
                         select(`Day`, `Month`, `Year`, `pH_Exceeded`) %>% 
                         na.omit()
WT3_TP_daily_exceed   <- Daily_TP_WT3 %>% 
                         select(`Day`, `Month`, `Year`, `TP_Exceeded`) %>% 
                         na.omit()

### WT5 ###
WT5_daily <- t(
             merge(WT5_FC_Exceeded_count_day, 
             merge(WT5_NH_Exceeded_count_day, 
             merge(WT5_TN_Exceeded_count_day, 
             merge(WT5_NOX_Exceeded_count_day, 
             merge(WT5_pH_Exceeded_count_day, 
             merge(WT5_TP_Exceeded_count_day, WT5_Temp_Exceeded_count_day))))), 
             by = "Site"))

```

Analysis : Monthly
```{r}
#Determine how many months from 2008 to 2020 that WT3 and WT5 exceeded water quality standard based on monthly average

### Monthly Average from 2008 - 2020 for WT3 ###
#TN
  TN_WT3_month     <- SWAMP_data %>% 
                      filter(Site %in% c("WT3")) %>% 
                      filter(Year %in% c(2008:2020)) %>% 
                      select(`Site`,`Month`, `Year`, `Total N (ug/L)`) %>% 
                      na.omit()
  Monthly_TN_WT3   <- TN_WT3_month %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      summarise(Mean_TN = mean(`Total N (ug/L)`)) %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      mutate(TN_Exceeded = ifelse(Mean_TN > 800, Mean_TN, NA))
#NH
  NH_WT3_month     <- SWAMP_data %>% 
                      filter(Site %in% c("WT3")) %>% 
                      filter(Year %in% c(2008:2020)) %>% 
                      select(`Site`,`Month`, `Year`, `NH4-N (ug/L)`) %>% 
                      na.omit()
  Monthly_NH_WT3   <- NH_WT3_month %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      summarise(Mean_NH = mean(`NH4-N (ug/L)`))%>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      mutate(NH_Exceeded = ifelse(Mean_NH > 20, Mean_NH, NA)) 
#NOX
  NOX_WT3_month    <- SWAMP_data %>% 
                      filter(Site %in% c("WT3")) %>% 
                      filter(Year %in% c(2008:2020)) %>% 
                      select(`Site`,`Month`, `Year`, `NOX`) %>% 
                      na.omit()
  Monthly_NOX_WT3  <- NOX_WT3_month %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      summarise(Mean_NOX = mean(`NOX`)) %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      mutate(NOX_Exceeded = ifelse(Mean_NOX > 345, Mean_NOX, NA))
#pH
  pH_WT3_month     <- SWAMP_data %>% 
                      filter(Site %in% c("WT3")) %>% 
                      filter(Year %in% c(2008:2020)) %>% 
                      select(`Site`,`Month`, `Year`, `pH`) %>% 
                      na.omit()
  Monthly_pH_WT3   <- pH_WT3_month %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      summarise(Mean_pH = mean(`pH`)) %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      mutate(pH_Exceeded = ifelse(!(Mean_pH >6) & !(Mean_pH < 9), Mean_pH, NA))
#Temp
  Temp_WT3_month   <- SWAMP_data %>% 
                      filter(Site %in% c("WT3")) %>% 
                      filter(Year %in% c(2008:2020)) %>% 
                      select(`Site`,`Month`, `Year`, `Temp C`) %>% 
                      na.omit()
  Monthly_Temp_WT3 <- Temp_WT3_month %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      summarise(Mean_Temp = mean(`Temp C`))%>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      mutate(Temp_Exceeded = ifelse(Mean_Temp > 32, Mean_Temp, NA)) 
#TP
  TP_WT3_month     <- SWAMP_data %>% 
                      filter(Site %in% c("WT3")) %>% 
                      filter(Year %in% c(2008:2020)) %>% 
                      select(`Site`,`Month`, `Year`, `UTP`) %>% 
                      na.omit()
  Monthly_TP_WT3   <- TP_WT3_month %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      summarise(Mean_TP = mean(`UTP`)) %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      mutate(TP_Exceeded = ifelse(Mean_TP > 30, Mean_TP, NA)) 
#FC
  FC_WT3_month     <- SWAMP_data %>% 
                      filter(Site %in% c("WT3")) %>% 
                      filter(Year %in% c(2008:2020)) %>% 
                      select(`Site`,`Month`, `Year`, `FC`) %>% 
                      na.omit()
  Monthly_FC_WT3   <- FC_WT3_month %>% 
                      group_by(`Site`,`Month`, `Year`) %>% 
                      summarise(Mean_FC = mean(`FC`)) %>% 
                      group_by(`Site`, `Year`, `Month`) %>% 
                      mutate(FC_Exceeded = ifelse(Mean_FC > 200, Mean_FC, NA))

### Monthly Average from 2008 - 2020 for WT5 ###
#TN
  TN_WT5_month      <- SWAMP_data %>% 
                       filter(Site %in% c("WT5")) %>% 
                       filter(Year %in% c(2008:2020)) %>% 
                       select(`Site`,`Month`, `Year`, `Total N (ug/L)`) %>% 
                       na.omit()
  Monthly_TN_WT5    <- TN_WT5_month %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       summarise(Mean_TN = mean(`Total N (ug/L)`)) %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       mutate(TN_Exceeded = ifelse(Mean_TN > 800, Mean_TN, NA))
#NH
  NH_WT5_month      <- SWAMP_data %>% 
                       filter(Site %in% c("WT5")) %>% 
                       filter(Year %in% c(2008:2020)) %>% 
                       select(`Site`,`Month`, `Year`, `NH4-N (ug/L)`) %>% 
                       na.omit()
  Monthly_NH_WT5    <- NH_WT5_month %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       summarise(Mean_NH = mean(`NH4-N (ug/L)`)) %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       mutate(NH_Exceeded = ifelse(Mean_NH > 20, Mean_NH, NA)) 
#NOX
  NOX_WT5_month     <- SWAMP_data %>% 
                       filter(Site %in% c("WT5")) %>% 
                       filter(Year %in% c(2008:2020)) %>% 
                       select(`Site`,`Month`, `Year`, `NOX`) %>% 
                       na.omit()
  Monthly_NOX_WT5   <- NOX_WT5_month %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       summarise(Mean_NOX = mean(`NOX`)) %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       mutate(NOX_Exceeded = ifelse(Mean_NOX > 345, Mean_NOX, NA))
#pH
  pH_WT5_month      <- SWAMP_data %>% 
                       filter(Site %in% c("WT5")) %>% 
                       filter(Year %in% c(2008:2020)) %>% 
                       select(`Site`,`Month`, `Year`, `pH`) %>% 
                       na.omit()
  Monthly_pH_WT5    <- pH_WT5_month %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       summarise(Mean_pH = mean(`pH`)) %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       mutate(pH_Exceeded = ifelse(!(Mean_pH >6) & !(Mean_pH < 9), Mean_pH, NA))
#Temp
  Temp_WT5_month    <- SWAMP_data %>% 
                       filter(Site %in% c("WT5")) %>% 
                       filter(Year %in% c(2008:2020)) %>% 
                       select(`Site`,`Month`, `Year`, `Temp C`) %>% 
                       na.omit()
  Monthly_Temp_WT5  <- Temp_WT5_month %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       summarise(Mean_Temp = mean(`Temp C`)) %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       mutate(Temp_Exceeded = ifelse(Mean_Temp > 32, Mean_Temp, NA)) 
#TP
  TP_WT5_month      <- SWAMP_data %>% 
                       filter(Site %in% c("WT5")) %>% 
                       filter(Year %in% c(2008:2020)) %>% 
                       select(`Site`,`Month`, `Year`, `UTP`) %>% 
                       na.omit()
  Monthly_TP_WT5    <- TP_WT5_month %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       summarise(Mean_TP = mean(`UTP`)) %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       mutate(TP_Exceeded = ifelse(Mean_TP > 30, Mean_TP, NA)) 
#FC
  FC_WT5_month      <- SWAMP_data %>% 
                       filter(Site %in% c("WT5")) %>% 
                       filter(Year %in% c(2008:2020)) %>% 
                       select(`Site`,`Month`, `Year`, `FC`) %>% 
                       na.omit()
  Monthly_FC_WT5    <- FC_WT5_month %>% 
                       group_by(`Site`,`Month`, `Year`) %>% 
                       summarise(Mean_FC = mean(`FC`)) %>% 
                       group_by(`Site`, `Year`, `Month`) %>% 
                       mutate(FC_Exceeded = ifelse(Mean_FC > 200, Mean_FC, NA))


  
### count how many months exceed water quality standard for WT3 ###
#TN
  WT3_TN_Exceeded_count_month   <- Monthly_TN_WT3 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_TN = sum(!is.na(TN_Exceeded)),
                                   Count_all_TN = sum(!is.na(Mean_TN)))
#NH
  WT3_NH_Exceeded_count_month   <- Monthly_NH_WT3 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_NH = sum(!is.na(NH_Exceeded)),
                                   Count_all_NH = sum(!is.na(Mean_NH)))  
#NOX
  WT3_NOX_Exceeded_count_month  <- Monthly_NOX_WT3 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_NOX = sum(!is.na(NOX_Exceeded)),
                                   Count_all_NOX = sum(!is.na(Mean_NOX)))
#pH
  WT3_pH_Exceeded_count_month   <- Monthly_pH_WT3 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_pH = sum(!is.na(pH_Exceeded)),
                                   Count_all_pH = sum(!is.na(Mean_pH)))
#Temp
  WT3_Temp_Exceeded_count_month <- Monthly_Temp_WT3 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_Temp = sum(!is.na(Temp_Exceeded)),
                                   Count_all_Temp = sum(!is.na(Mean_Temp)))
#TP
  WT3_TP_Exceeded_count_month   <- Monthly_TP_WT3 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_TP = sum(!is.na(TP_Exceeded)),
                                   Count_all_TP = sum(!is.na(Mean_TP)))
#FC
  WT3_FC_Exceeded_count_month   <- Monthly_FC_WT3 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_FC = sum(!is.na(FC_Exceeded)),
                                   Count_all_FC = sum(!is.na(Mean_FC)))

### count how many months exceed water quality standard for WT5 ###
#TN
  WT5_TN_Exceeded_count_month   <- Monthly_TN_WT5 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_TN = sum(!is.na(TN_Exceeded)),
                                   Count_all_TN = sum(!is.na(Mean_TN)))
#NH
  WT5_NH_Exceeded_count_month   <- Monthly_NH_WT5 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_NH = sum(!is.na(NH_Exceeded)),
                                   Count_all_NH = sum(!is.na(Mean_NH)))  
#NOX
  WT5_NOX_Exceeded_count_month  <- Monthly_NOX_WT5 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_NOX = sum(!is.na(NOX_Exceeded)),
                                   Count_all_NOX = sum(!is.na(Mean_NOX)))
#pH
  WT5_pH_Exceeded_count_month   <- Monthly_pH_WT5 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_pH = sum(!is.na(pH_Exceeded)),
                                   Count_all_pH = sum(!is.na(Mean_pH)))
#Temp
  WT5_Temp_Exceeded_count_month <- Monthly_Temp_WT5 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_Temp = sum(!is.na(Temp_Exceeded)),
                                   Count_all_Temp = sum(!is.na(Mean_Temp)))
#TP
  WT5_TP_Exceeded_count_month   <- Monthly_TP_WT5 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_TP = sum(!is.na(TP_Exceeded)),
                                   Count_all_TP = sum(!is.na(Mean_TP)))
#FC
  WT5_FC_Exceeded_count_month   <- Monthly_FC_WT5 %>% 
                                   group_by(Site) %>%
                                   summarize(count_exceed_FC = sum(!is.na(FC_Exceeded)),
                                   Count_all_FC = sum(!is.na(Mean_FC)))
  
```

Monthly Summary:
```{r}
```

Analysis : Yearly
```{r}
#Determine how many yearss from 2008 to 2020 that WT3 and WT5 exceeded water quality standard based on yearly average

### Yearly Average from 2008 - 2020 for WT3 ###
#TN
  TN_WT3_year     <- SWAMP_data %>% 
                     filter(Site %in% c("WT3")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `Total N (ug/L)`) %>% 
                     na.omit()
  Yearly_TN_WT3   <- TN_WT3_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_TN = mean(`Total N (ug/L)`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(TN_Exceeded = ifelse(Mean_TN > 800, Mean_TN, NA))
#NH
  NH_WT3_year     <- SWAMP_data %>% 
                     filter(Site %in% c("WT3")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`,`Year`, `NH4-N (ug/L)`) %>% 
                     na.omit()
  Yearly_NH_WT3   <- NH_WT3_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_NH = mean(`NH4-N (ug/L)`))%>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(NH_Exceeded = ifelse(Mean_NH > 20, Mean_NH, NA)) 
#NOX
  NOX_WT3_year    <- SWAMP_data %>% 
                     filter(Site %in% c("WT3")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `NOX`) %>% 
                     na.omit()
  Yearly_NOX_WT3  <- NOX_WT3_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_NOX = mean(`NOX`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(NOX_Exceeded = ifelse(Mean_NOX > 345, Mean_NOX, NA))
#pH
  pH_WT3_year     <- SWAMP_data %>% 
                     filter(Site %in% c("WT3")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `pH`) %>% 
                     na.omit()
  Yearly_pH_WT3   <- pH_WT3_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_pH = mean(`pH`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(pH_Exceeded = ifelse(!(Mean_pH >6) & !(Mean_pH < 9), Mean_pH, NA))
#Temp
  Temp_WT3_year   <- SWAMP_data %>% 
                     filter(Site %in% c("WT3")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `Temp C`) %>% 
                     na.omit()
  Yearly_Temp_WT3 <- Temp_WT3_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_Temp = mean(`Temp C`))%>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(Temp_Exceeded = ifelse(Mean_Temp > 32, Mean_Temp, NA)) 
#TP
  TP_WT3_year     <- SWAMP_data %>% 
                     filter(Site %in% c("WT3")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `UTP`) %>% 
                     na.omit()
  Yearly_TP_WT3   <- TP_WT3_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_TP = mean(`UTP`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(TP_Exceeded = ifelse(Mean_TP > 30, Mean_TP, NA)) 
#FC
  FC_WT3_year     <- SWAMP_data %>% 
                     filter(Site %in% c("WT3")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `FC`) %>% 
                     na.omit()
  Yearly_FC_WT3   <- FC_WT3_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_FC = mean(`FC`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(FC_Exceeded = ifelse(Mean_FC > 200, Mean_FC, NA))

### Yearly Average from 2008 - 2020 for WT5 ###
#TN
  TN_WT5_year     <- SWAMP_data %>% 
                     filter(Site %in% c("WT5")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `Total N (ug/L)`) %>% 
                     na.omit()
  Yearly_TN_WT5   <- TN_WT5_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_TN = mean(`Total N (ug/L)`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(TN_Exceeded = ifelse(Mean_TN > 800, Mean_TN, NA))
#NH
  NH_WT5_year     <- SWAMP_data %>% 
                     filter(Site %in% c("WT5")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`,`Year`, `NH4-N (ug/L)`) %>% 
                     na.omit()
  Yearly_NH_WT5   <- NH_WT5_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_NH = mean(`NH4-N (ug/L)`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(NH_Exceeded = ifelse(Mean_NH > 20, Mean_NH, NA)) 
#NOX
  NOX_WT5_year    <- SWAMP_data %>% 
                     filter(Site %in% c("WT5")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `NOX`) %>% 
                     na.omit()
  Yearly_NOX_WT5  <- NOX_WT5_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_NOX = mean(`NOX`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(NOX_Exceeded = ifelse(Mean_NOX > 345, Mean_NOX, NA))
#pH
  pH_WT5_year     <- SWAMP_data %>% 
                     filter(Site %in% c("WT5")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `pH`) %>% 
                     na.omit()
  Yearly_pH_WT5   <- pH_WT5_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_pH = mean(`pH`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(pH_Exceeded = ifelse(!(Mean_pH >6) & !(Mean_pH < 9), Mean_pH, NA))
#Temp
  Temp_WT5_year   <- SWAMP_data %>% 
                     filter(Site %in% c("WT5")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `Temp C`) %>% 
                     na.omit()
  Yearly_Temp_WT5 <- Temp_WT5_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_Temp = mean(`Temp C`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(Temp_Exceeded = ifelse(Mean_Temp > 32, Mean_Temp, NA)) 
#TP
  TP_WT5_year     <- SWAMP_data %>% 
                     filter(Site %in% c("WT5")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `UTP`) %>% 
                     na.omit()
  Yearly_TP_WT5   <- TP_WT5_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_TP = mean(`UTP`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(TP_Exceeded = ifelse(Mean_TP > 30, Mean_TP, NA)) 
#FC
  FC_WT5_year     <- SWAMP_data %>% 
                     filter(Site %in% c("WT5")) %>% 
                     filter(Year %in% c(2008:2020)) %>% 
                     select(`Site`, `Year`, `FC`) %>% 
                     na.omit()
  Yearly_FC_WT5   <- FC_WT5_year %>% 
                     group_by(`Site`, `Year`) %>% 
                     summarise(Mean_FC = mean(`FC`)) %>% 
                     group_by(`Site`, `Year`) %>% 
                     mutate(FC_Exceeded = ifelse(Mean_FC > 200, Mean_FC, NA))


  
### count how many years exceed water quality standard for WT3 ###
#TN
  WT3_TN_Exceeded_count_year   <- Yearly_TN_WT3 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_TN = sum(!is.na(TN_Exceeded)),
                                  Count_all_TN = sum(!is.na(Mean_TN)))
#NH
  WT3_NH_Exceeded_count_year   <- Yearly_NH_WT3 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_NH = sum(!is.na(NH_Exceeded)),
                                  Count_all_NH = sum(!is.na(Mean_NH)))  
#NOX
  WT3_NOX_Exceeded_count_year  <- Yearly_NOX_WT3 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_NOX = sum(!is.na(NOX_Exceeded)),
                                  Count_all_NOX = sum(!is.na(Mean_NOX)))
#pH
  WT3_pH_Exceeded_count_year   <- Yearly_pH_WT3 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_pH = sum(!is.na(pH_Exceeded)),
                                  Count_all_pH = sum(!is.na(Mean_pH)))
#Temp
  WT3_Temp_Exceeded_count_year <- Yearly_Temp_WT3 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_Temp = sum(!is.na(Temp_Exceeded)),
                                  Count_all_Temp = sum(!is.na(Mean_Temp)))
#TP
  WT3_TP_Exceeded_count_year   <- Yearly_TP_WT3 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_TP = sum(!is.na(TP_Exceeded)),
                                  Count_all_TP = sum(!is.na(Mean_TP)))
#FC
  WT3_FC_Exceeded_count_year   <- Yearly_FC_WT3 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_FC = sum(!is.na(FC_Exceeded)),
                                  Count_all_FC = sum(!is.na(Mean_FC)))

### count how many months exceed water quality standard for WT5 ###
#TN
  WT5_TN_Exceeded_count_year   <- Yearly_TN_WT5 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_TN = sum(!is.na(TN_Exceeded)),
                                  Count_all_TN = sum(!is.na(Mean_TN)))
#NH
  WT5_NH_Exceeded_count_year   <- Yearly_NH_WT5 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_NH = sum(!is.na(NH_Exceeded)),
                                  Count_all_NH = sum(!is.na(Mean_NH)))  
#NOX
  WT5_NOX_Exceeded_count_year  <- Yearly_NOX_WT5 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_NOX = sum(!is.na(NOX_Exceeded)),
                                  Count_all_NOX = sum(!is.na(Mean_NOX)))
#pH
  WT5_pH_Exceeded_count_year   <- Yearly_pH_WT5 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_pH = sum(!is.na(pH_Exceeded)),
                                  Count_all_pH = sum(!is.na(Mean_pH)))
#Temp
  WT5_Temp_Exceeded_count_year <- Yearly_Temp_WT5 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_Temp = sum(!is.na(Temp_Exceeded)),
                                  Count_all_Temp = sum(!is.na(Mean_Temp)))
#TP
  WT5_TP_Exceeded_count_year   <- Yearly_TP_WT5 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_TP = sum(!is.na(TP_Exceeded)),
                                  Count_all_TP = sum(!is.na(Mean_TP)))
#FC
  WT5_FC_Exceeded_count_year   <- Yearly_FC_WT5 %>% 
                                  group_by(Site) %>%
                                  summarize(count_exceed_FC = sum(!is.na(FC_Exceeded)),
                                  Count_all_FC = sum(!is.na(Mean_FC)))
```

Yearly Summary:
```{r}
```

Water Quality Index
```{r}


```



